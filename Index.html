<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <?!= include('Styles.html'); ?>
</head>
<body>
  <!-- LOGIN -->
  <div class="login" id="loginScreen">
    <div class="login-card">
      <div class="login-header">
        <h1 class="login-title">BEM</h1>
        <p class="login-subtitle">Booking Engine Machine</p>
      </div>
      <div class="login-form">
        <label class="label">Team Member</label>
        <select id="userSelect" class="select">
          <option value="">Select your name...</option>
        </select>
        <button class="btn btn-primary btn-full" onclick="handleLogin()">Sign In</button>
      </div>
    </div>
  </div>

  <!-- APP -->
  <div class="app" id="appContainer">
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <span class="logo">BEM</span>
        <button class="btn-icon sidebar-close" onclick="toggleSidebar()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
        </button>
      </div>

      <nav class="nav">
        <button class="nav-item active" data-view="dashboard" onclick="switchView('dashboard')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
          <span>Dashboard</span>
        </button>
        <button class="nav-item" data-view="leads" onclick="switchView('leads')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          <span>All Leads</span>
          <span class="badge" id="navLeadsCount">0</span>
        </button>
        <button class="nav-item" data-view="my" onclick="switchView('my')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          <span>My Leads</span>
          <span class="badge" id="navMyCount">0</span>
        </button>
        <button class="nav-item" data-view="hot" onclick="switchView('hot')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2c1 3 2.5 3.5 3.5 4.5A5 5 0 0 1 17 10a5 5 0 1 1-10 0c0-.3 0-.6.1-.9a4 4 0 0 0 4.9-3.6c.1-.4.1-.8 0-1.2A9 9 0 0 0 12 2z"/></svg>
          <span>Hot Leads</span>
          <span class="badge badge-hot" id="navHotCount">0</span>
        </button>
        <button class="nav-item" data-view="followups" onclick="switchView('followups')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          <span>Today's Follow Ups</span>
          <span class="badge badge-urgent" id="navFollowupsCount">0</span>
        </button>
        <button class="nav-item" data-view="contracts" onclick="switchView('contracts')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
          <span>Contracts Review</span>
          <span class="badge" id="navContractsCount">0</span>
        </button>
        <button class="nav-item" data-view="dhill" onclick="switchView('dhill')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
          <span>Dhill Review</span>
          <span class="badge" id="navDhillCount">0</span>
        </button>
        <button class="nav-item" data-view="booked" onclick="switchView('booked')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
          <span>Booked</span>
          <span class="badge badge-success" id="navBookedCount">0</span>
        </button>
        <button class="nav-item" data-view="parking" onclick="switchView('parking')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
          <span>Archive</span>
          <span class="badge" id="navParkingCount">0</span>
        </button>
        <button class="nav-item" data-view="storage" onclick="switchView('storage')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/></svg>
          <span>Storage</span>
          <span class="badge" id="navStorageCount">0</span>
        </button>
        <button class="nav-item" data-view="research" onclick="switchView('research')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
          <span>Research Queue</span>
          <span class="badge" id="navResearchCount">0</span>
        </button>
        <button class="nav-item" data-view="calls" onclick="switchView('calls')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/><path d="M14.05 2a9 9 0 0 1 8 7.94"/><path d="M14.05 6A5 5 0 0 1 18 10"/></svg>
          <span>Call History</span>
        </button>
        <button class="nav-item" data-view="analytics" onclick="switchView('analytics')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
          <span>Analytics</span>
        </button>
        <button class="nav-item" data-view="eod" onclick="switchView('eod')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/><path d="M9 12h6"/><path d="M9 16h6"/></svg>
          <span>Daily Check-in</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <div class="user-card">
          <div class="avatar" id="userAvatar">U</div>
          <div class="user-info">
            <span class="user-name" id="userName">User</span>
            <span class="user-role" id="userRole">Team</span>
          </div>
          <button class="btn-icon" onclick="logout()" title="Sign out">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          </button>
        </div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <header class="header">
        <div class="header-left">
          <button class="btn-icon mobile-menu" onclick="toggleSidebar()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
          </button>
          <h1 class="page-title" id="pageTitle">Dashboard</h1>
        </div>
        <div class="header-right">
          <div class="search-box">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
            <input type="text" id="searchInput" placeholder="Search leads...">
          </div>
          <button class="btn btn-primary" onclick="openAddLead()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            <span class="btn-text">Add Lead</span>
          </button>
        </div>
      </header>

      <div class="content">
        <!-- DASHBOARD VIEW -->
        <div class="view active" id="dashboardView">
          <div class="metrics">
            <div class="metric">
              <div class="metric-value" id="statPipeline">$0</div>
              <div class="metric-label">Pipeline Value</div>
            </div>
            <div class="metric metric-highlight">
              <div class="metric-value" id="statFollowups">0</div>
              <div class="metric-label">Follow Ups Today</div>
            </div>
            <div class="metric">
              <div class="metric-value" id="statHot">0</div>
              <div class="metric-label">Hot Leads</div>
            </div>
          </div>

          <div class="section">
            <div class="section-header">
              <h2 class="section-title">Today's Queue</h2>
              <span class="section-count" id="queueCount">0 leads to contact</span>
            </div>
            <div class="queue" id="todayQueue"></div>
          </div>

          <div class="section">
            <div class="section-header">
              <h2 class="section-title">Recent Hot Leads</h2>
              <button class="btn-link" onclick="switchView('hot')">View all</button>
            </div>
            <div class="leads-list" id="recentHotLeads"></div>
          </div>

          <div class="section">
            <div class="section-header">
              <h2 class="section-title">Team Performance</h2>
              <select class="select select-sm" id="perfPeriod" onchange="loadTeamPerformance()">
                <option value="today">Today</option>
                <option value="week" selected>This Week</option>
                <option value="month">This Month</option>
              </select>
            </div>
            <div class="team-performance" id="teamPerformance"></div>
          </div>
        </div>

        <!-- LIST VIEW -->
        <div class="view" id="listView">
          <div class="filters">
            <div class="filter-group">
              <select class="select select-sm" id="filterStatus"><option value="">All Statuses</option></select>
              <select class="select select-sm" id="filterOwner"><option value="">All Owners</option></select>
              <select class="select select-sm" id="filterSource"><option value="">All Sources</option></select>
            </div>
            <div class="filter-info"><span id="listCount">0 leads</span></div>
          </div>
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th class="th-check"><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
                  <th class="sortable" onclick="sortBy('Contact_Person')">Contact</th>
                  <th class="sortable" onclick="sortBy('Event_Name')">Event</th>
                  <th class="sortable" onclick="sortBy('Lead_Status')">Status</th>
                  <th class="sortable" onclick="sortBy('Active_Quote')">Quote</th>
                  <th class="sortable" onclick="sortBy('Lead_Owner')">Owner</th>
                  <th class="sortable" onclick="sortBy('Date_Last_Touch')">Last Touch</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="leadsTableBody"></tbody>
            </table>
          </div>
          <div class="bulk-bar" id="bulkBar">
            <span class="bulk-count"><span id="selectedCount">0</span> selected</span>
            <div class="bulk-actions">
              <button class="btn btn-sm" onclick="bulkEmail()">Email</button>
              <button class="btn btn-sm" onclick="bulkGenerateContracts()">Generate Contracts</button>
            </div>
          </div>
        </div>

        <!-- RESEARCH QUEUE VIEW -->
        <div class="view" id="researchView">
          <div class="research-layout">
            <div class="research-list-panel">
              <div class="panel-header">
                <h3>Pending Research</h3>
                <button class="btn btn-sm btn-primary" onclick="openAddResearch()">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px;"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                  Add
                </button>
              </div>
              <div class="research-list" id="researchList"></div>
            </div>
            <div class="research-detail-panel" id="researchDetailPanel">
              <div class="empty-state" id="researchEmptyState">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                <h3>Select a lead to research</h3>
                <p>Click on a lead from the list to start researching</p>
              </div>
              <div class="research-detail" id="researchDetail" style="display: none;">
                <input type="hidden" id="researchRowIndex">
                <div class="research-section">
                  <div class="research-section-title">Original Bark.com Info</div>
                  <div class="research-original">
                    <div class="research-field"><span class="research-label">Looking For</span><span class="research-value" id="researchLookingFor">-</span></div>
                    <div class="research-field"><span class="research-label">City/Location</span><span class="research-value" id="researchCity">-</span></div>
                    <div class="research-field"><span class="research-label">Event Type</span><span class="research-value" id="researchEventType">-</span></div>
                    <div class="research-field"><span class="research-label">Date Needed</span><span class="research-value" id="researchDateNeeded">-</span></div>
                    <div class="research-field"><span class="research-label">Guest Count</span><span class="research-value" id="researchGuestCount">-</span></div>
                    <div class="research-field"><span class="research-label">Budget Range</span><span class="research-value" id="researchBudget">-</span></div>
                    <div class="research-field full-width"><span class="research-label">Message</span><span class="research-value" id="researchMessage">-</span></div>
                  </div>
                </div>
                <div class="research-section">
                  <div class="research-section-title">Quick Search</div>
                  <div class="research-search-links">
                    <a href="#" id="linkedinSearchLink" target="_blank" class="btn btn-sm">LinkedIn</a>
                    <a href="#" id="googleSearchLink" target="_blank" class="btn btn-sm">Google</a>
                    <a href="#" id="facebookSearchLink" target="_blank" class="btn btn-sm">Facebook</a>
                  </div>
                </div>
                <div class="research-section">
                  <div class="research-section-title">Found Information</div>
                  <div class="form-row">
                    <div class="form-group"><label class="label">Contact Name</label><input type="text" class="input" id="researchFoundName" placeholder="Full name..."></div>
                    <div class="form-group"><label class="label">Company</label><input type="text" class="input" id="researchFoundCompany" placeholder="Company name..."></div>
                  </div>
                  <div class="form-row">
                    <div class="form-group"><label class="label">Email</label><input type="email" class="input" id="researchFoundEmail" placeholder="email@example.com"></div>
                    <div class="form-group"><label class="label">Phone</label><input type="tel" class="input" id="researchFoundPhone" placeholder="(555) 555-5555"></div>
                  </div>
                </div>
                <div class="research-actions">
                  <button class="btn" onclick="markResearchNotFound()">Couldn't Find</button>
                  <button class="btn btn-primary" onclick="saveAndMoveToLeads()">Save & Move to Leads</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- CALL HISTORY VIEW -->
        <div class="view" id="callsView">
          <div class="calls-container">
            <div class="calls-header">
              <div class="calls-header-left">
                <h2>Call History</h2>
                <p class="calls-subtitle">Dialpad calls synced with AI grading</p>
              </div>
              <div class="calls-header-right">
                <select class="select" id="callsPeriod" onchange="loadCallHistory()">
                  <option value="1">Today</option>
                  <option value="7" selected>Last 7 Days</option>
                  <option value="30">Last 30 Days</option>
                </select>
                <button class="btn btn-primary" onclick="syncDialpadCalls()">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;margin-right:6px;"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                  Sync Dialpad
                </button>
              </div>
            </div>
            
            <div class="calls-stats">
              <div class="call-stat">
                <div class="call-stat-value" id="callsTotalCount">0</div>
                <div class="call-stat-label">Total Calls</div>
              </div>
              <div class="call-stat">
                <div class="call-stat-value" id="callsConversations">0</div>
                <div class="call-stat-label">Conversations</div>
              </div>
              <div class="call-stat">
                <div class="call-stat-value" id="callsAvgDuration">0m</div>
                <div class="call-stat-label">Avg Duration</div>
              </div>
              <div class="call-stat">
                <div class="call-stat-value" id="callsAvgScore">-</div>
                <div class="call-stat-label">Avg AI Score</div>
              </div>
            </div>

            <div class="calls-list" id="callsList">
              <div class="empty-state">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:48px;height:48px;margin-bottom:16px;opacity:0.5;"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                <h3>No calls synced yet</h3>
                <p>Click "Sync Dialpad" to pull your team's call history</p>
              </div>
            </div>
          </div>
        </div>

        <!-- ANALYTICS VIEW -->
        <div class="view" id="analyticsView">
          <div class="analytics-container">
            <div class="analytics-header">
              <div>
                <h2>Analytics Dashboard</h2>
                <p class="analytics-subtitle">Team performance & pipeline insights</p>
              </div>
              <div class="analytics-controls">
                <select class="select" id="analyticsPeriod" onchange="loadAnalytics()">
                  <option value="today">Today</option>
                  <option value="week" selected>This Week</option>
                  <option value="month">This Month</option>
                  <option value="quarter">This Quarter</option>
                </select>
                <button class="btn" onclick="loadAnalytics()">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                  Refresh
                </button>
              </div>
            </div>
            
            <!-- KPI CARDS -->
            <div class="analytics-section">
              <h3 class="analytics-section-title">Pipeline Overview</h3>
              <div class="pipeline-cards">
                <div class="pipeline-card">
                  <div class="pipeline-card-value" id="analyticsTotalValue">$0</div>
                  <div class="pipeline-card-label">Total Pipeline</div>
                  <div class="pipeline-card-count"><span id="analyticsTotalLeads">0</span> active leads</div>
                </div>
                <div class="pipeline-card hot">
                  <div class="pipeline-card-value" id="analyticsHotValue">$0</div>
                  <div class="pipeline-card-label">Hot Leads Value</div>
                  <div class="pipeline-card-count"><span id="analyticsHotLeads">0</span> hot leads</div>
                </div>
                <div class="pipeline-card booked">
                  <div class="pipeline-card-value">
                    <span id="analyticsBookedValue">$0</span>
                    <span class="kpi-change" id="analyticsBookedChange"></span>
                  </div>
                  <div class="pipeline-card-label">Booked Revenue</div>
                  <div class="pipeline-card-count"><span id="analyticsBookedCount">0</span> shows booked</div>
                </div>
                <div class="pipeline-card conversion">
                  <div class="pipeline-card-value" id="analyticsConversion">0%</div>
                  <div class="pipeline-card-label">Conversion Rate</div>
                  <div class="pipeline-card-count">$ booked / $ total</div>
                </div>
              </div>
            </div>
            
            <!-- FUNNEL + SOURCES -->
            <div class="analytics-row">
              <div class="analytics-section analytics-half">
                <h3 class="analytics-section-title">Conversion Funnel</h3>
                <div class="funnel-container" id="funnelContainer"></div>
              </div>
              
              <div class="analytics-section analytics-half">
                <h3 class="analytics-section-title">Lead Sources (by Pipeline $)</h3>
                <div class="sources-list" id="sourcesList"></div>
              </div>
            </div>
            
            <!-- TEAM LEADERBOARD -->
            <div class="analytics-section">
              <h3 class="analytics-section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:20px;height:20px;margin-right:8px;"><path d="M12 15l-2 5l9-13h-6l2-5l-9 13h6z"/></svg>
                Team Leaderboard
              </h3>
              <div class="leaderboard-table-container">
                <table class="leaderboard-table">
                  <thead>
                    <tr>
                      <th style="width:60px;text-align:center;">Rank</th>
                      <th style="text-align:left;">Team Member</th>
                      <th style="text-align:right;">$ Booked</th>
                      <th style="text-align:center;">Deals</th>
                      <th style="text-align:right;">Pipeline $</th>
                      <th style="text-align:center;">Calls</th>
                      <th style="text-align:center;">Convos</th>
                      <th style="text-align:center;">AI Score</th>
                      <th style="text-align:right;">Points</th>
                    </tr>
                  </thead>
                  <tbody id="leaderboardBody"></tbody>
                </table>
              </div>
            </div>
            
            <!-- ACTIVITY TRENDS -->
            <div class="analytics-section">
              <h3 class="analytics-section-title">Activity Trends</h3>
              <div class="trends-chart" id="trendsChart"></div>
            </div>
            
            <!-- RECENT BOOKINGS -->
            <div class="analytics-section">
              <h3 class="analytics-section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:20px;height:20px;margin-right:8px;"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                Recent Bookings
              </h3>
              <div class="bookings-list" id="recentBookingsList"></div>
            </div>
          </div>
        </div>

        <!-- EOD CHECK-IN VIEW -->
        <div class="view" id="eodView">
          <div class="checkin-container">
            <div class="checkin-header">
              <div>
                <h2>Daily Check-in</h2>
                <p class="checkin-subtitle">Quick summary of your day</p>
              </div>
              <span class="checkin-date" id="checkinDate"></span>
            </div>
            
            <div class="checkin-section">
              <div class="checkin-section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:18px;height:18px;"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                Your Activity Today
              </div>
              <div class="checkin-stats">
                <div class="checkin-stat">
                  <div class="checkin-stat-icon calls">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                  </div>
                  <div class="checkin-stat-value" id="checkinCalls">0</div>
                  <div class="checkin-stat-label">Calls Made</div>
                </div>
                <div class="checkin-stat">
                  <div class="checkin-stat-icon convos">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                  </div>
                  <div class="checkin-stat-value" id="checkinConvos">0</div>
                  <div class="checkin-stat-label">Conversations</div>
                </div>
                <div class="checkin-stat">
                  <div class="checkin-stat-icon followups">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="M12 6v6l4 2"/></svg>
                  </div>
                  <div class="checkin-stat-value" id="checkinFollowups">0</div>
                  <div class="checkin-stat-label">Follow Ups</div>
                </div>
                <div class="checkin-stat">
                  <div class="checkin-stat-icon upgrades">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M23 6l-9.5 9.5-5-5L1 18"/><path d="M17 6h6v6"/></svg>
                  </div>
                  <div class="checkin-stat-value" id="checkinUpgrades">0</div>
                  <div class="checkin-stat-label">Leads Upgraded</div>
                </div>
                <div class="checkin-stat">
                  <div class="checkin-stat-icon contracts">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>
                  </div>
                  <div class="checkin-stat-value" id="checkinContracts">0</div>
                  <div class="checkin-stat-label">Contracts</div>
                </div>
              </div>
              
              <div class="checkin-ai-score" id="checkinAiScore" style="display:none;">
                <div class="ai-score-label">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:16px;height:16px;"><path d="M12 2a10 10 0 1 0 10 10H12V2z"/></svg>
                  Avg AI Call Score
                </div>
                <div class="ai-score-value" id="checkinAiScoreValue">-</div>
              </div>
            </div>
            
            <div class="checkin-section">
              <div class="checkin-section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:18px;height:18px;"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>
                How was your day?
              </div>
              <div class="mood-selector">
                <button type="button" class="mood-btn" data-mood="rough" onclick="selectMood(this)" title="Rough day">
                  <span class="mood-emoji">üò´</span>
                  <span class="mood-text">Rough</span>
                </button>
                <button type="button" class="mood-btn" data-mood="okay" onclick="selectMood(this)" title="It was okay">
                  <span class="mood-emoji">üòê</span>
                  <span class="mood-text">Okay</span>
                </button>
                <button type="button" class="mood-btn" data-mood="good" onclick="selectMood(this)" title="Good day">
                  <span class="mood-emoji">üòä</span>
                  <span class="mood-text">Good</span>
                </button>
                <button type="button" class="mood-btn" data-mood="great" onclick="selectMood(this)" title="Great day!">
                  <span class="mood-emoji">üî•</span>
                  <span class="mood-text">On Fire!</span>
                </button>
              </div>
            </div>
            
            <div class="checkin-section">
              <div class="checkin-section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:18px;height:18px;"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
                Quick Feedback <span class="optional-tag">Optional</span>
              </div>
              <div class="checkin-feedback">
                <div class="form-group">
                  <label class="label">Any roadblocks or challenges?</label>
                  <textarea class="textarea" id="checkinRoadblocks" rows="2" placeholder="What got in your way today?"></textarea>
                </div>
                <div class="form-group">
                  <label class="label">Wins or notable leads?</label>
                  <textarea class="textarea" id="checkinWins" rows="2" placeholder="Any wins worth celebrating?"></textarea>
                </div>
              </div>
            </div>
            
            <div class="checkin-actions">
              <button class="btn btn-primary btn-lg" onclick="submitCheckin()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:18px;height:18px;"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="M22 4L12 14.01l-3-3"/></svg>
                Submit Check-in
              </button>
              <p class="checkin-note">Takes 30 seconds ‚Ä¢ Your stats are auto-tracked</p>
            </div>
          </div>
        </div>
      </div>

      <!-- LEAD MODAL -->
      <div class="modal-backdrop" id="leadModal" onclick="closeModalOnBackdrop(event, 'leadModal')">
        <div class="modal modal-lg">
          <div class="modal-header">
            <h2 class="modal-title" id="modalTitle">Add Lead</h2>
            <div class="modal-header-actions">
              <span class="record-id" id="displayRecordId"></span>
              <button class="btn-icon" onclick="closeModal('leadModal')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
              </button>
            </div>
          </div>
          <div class="modal-tabs">
            <button class="modal-tab active" data-tab="contact" onclick="switchModalTab('contact')">Contact Info</button>
            <button class="modal-tab" data-tab="event" onclick="switchModalTab('event')">Event Details</button>
            <button class="modal-tab" data-tab="company" onclick="switchModalTab('company')">Company</button>
            <button class="modal-tab" data-tab="venue" onclick="switchModalTab('venue')">Venue</button>
            <button class="modal-tab" data-tab="status" onclick="switchModalTab('status')">Status & Tracking</button>
            <button class="modal-tab" data-tab="notes" onclick="switchModalTab('notes')">Notes</button>
          </div>
          <div class="modal-body">
            <form id="leadForm">
              <input type="hidden" id="leadRowIndex">
              <input type="hidden" id="fieldRecordId">
              <div class="tab-panel active" id="tabContact">
                <div class="form-row"><div class="form-group"><label class="label">Contact Person *</label><input type="text" class="input" id="fieldContactPerson" required></div><div class="form-group"><label class="label">Email</label><input type="email" class="input" id="fieldEmail"></div></div>
                <div class="form-row"><div class="form-group"><label class="label">Phone Number</label><input type="tel" class="input" id="fieldPhoneNumber"></div><div class="form-group"><label class="label">Time Zone</label><select class="select" id="fieldTimeZone"></select></div></div>
                <div class="form-row"><div class="form-group"><label class="label">Type of Phone</label><select class="select" id="fieldTypeOfPhone"></select></div><div class="form-group"><label class="label">Lead Owner</label><select class="select" id="fieldLeadOwner"></select></div></div>
              </div>
              <div class="tab-panel" id="tabEvent">
                <div class="form-row"><div class="form-group"><label class="label">Event Name</label><input type="text" class="input" id="fieldEventName"></div><div class="form-group"><label class="label">Category</label><select class="select" id="fieldCategory"></select></div></div>
                <div class="form-row"><div class="form-group"><label class="label">Date of Event</label><input type="date" class="input" id="fieldDateOfEvent"></div><div class="form-group"><label class="label">Month of Event</label><select class="select" id="fieldMonthOfEvent"></select></div></div>
                <div class="form-row"><div class="form-group"><label class="label">Number of Guests</label><input type="number" class="input" id="fieldNumberOfGuests"></div><div class="form-group"><label class="label">What Did We Pitch?</label><select class="select" id="fieldWhatPitched"></select></div></div>
                <div class="form-row"><div class="form-group"><label class="label">Active Quote</label><input type="text" class="input" id="fieldActiveQuote" placeholder="$0.00"></div><div class="form-group"><label class="label">Old Quote</label><input type="text" class="input" id="fieldOldQuote" placeholder="$0.00"></div></div>
              </div>
              <div class="tab-panel" id="tabCompany">
                <div class="form-row"><div class="form-group form-group-full"><label class="label">Company Name</label><input type="text" class="input" id="fieldCompanyName"></div></div>
                <div class="form-row"><div class="form-group form-group-full"><label class="label">Address Line 1</label><input type="text" class="input" id="fieldCompanyAddress1"></div></div>
                <div class="form-row"><div class="form-group form-group-full"><label class="label">Address Line 2</label><input type="text" class="input" id="fieldCompanyAddress2"></div></div>
                <div class="form-row"><div class="form-group"><label class="label">City</label><input type="text" class="input" id="fieldCompanyCity"></div><div class="form-group"><label class="label">State</label><select class="select" id="fieldCompanyState"></select></div></div>
                <div class="form-row"><div class="form-group"><label class="label">Zip Code</label><input type="text" class="input" id="fieldCompanyZip"></div><div class="form-group"></div></div>
              </div>
              <div class="tab-panel" id="tabVenue">
                <div class="form-row"><div class="form-group form-group-full"><label class="label">Venue Name</label><input type="text" class="input" id="fieldVenueName"></div></div>
                <div class="form-row"><div class="form-group form-group-full"><label class="label">Address Line 1</label><input type="text" class="input" id="fieldVenueAddress1"></div></div>
                <div class="form-row"><div class="form-group form-group-full"><label class="label">Address Line 2</label><input type="text" class="input" id="fieldVenueAddress2"></div></div>
                <div class="form-row"><div class="form-group"><label class="label">City</label><input type="text" class="input" id="fieldVenueCity"></div><div class="form-group"><label class="label">State</label><select class="select" id="fieldVenueState"></select></div></div>
                <div class="form-row"><div class="form-group"><label class="label">Zip Code</label><input type="text" class="input" id="fieldVenueZip"></div><div class="form-group"></div></div>
              </div>
              <div class="tab-panel" id="tabStatus">
                <div class="form-row"><div class="form-group"><label class="label">Lead Status</label><select class="select" id="fieldLeadStatus"></select></div><div class="form-group"><label class="label">Lead Source</label><select class="select" id="fieldLeadSource"></select></div></div>
                <div class="form-row"><div class="form-group"><label class="label">Date of Next Follow Up</label><input type="date" class="input" id="fieldDateNextFollowup"></div><div class="form-group"><label class="label">Month of Pitch Event</label><select class="select" id="fieldMonthPitchEvent"></select></div></div>
                <div class="form-row"><div class="form-group"><label class="label">Dhill Call List?</label><select class="select" id="fieldDhillCallList"></select></div><div class="form-group"><label class="label">D Call List</label><select class="select" id="fieldDCallList"></select></div></div>
                <div class="form-row"><div class="form-group"><label class="label">Create Mock Contract?</label><select class="select" id="fieldCreateMockContract"></select></div><div class="form-group"><label class="label">Quick Call Notes</label><select class="select" id="fieldQuickCallNotes"></select></div></div>
                <div class="form-row"><div class="form-group"><label class="label">Add to Book List?</label><select class="select" id="fieldAddToBooklist"></select></div><div class="form-group"><label class="label">Add to PCL?</label><select class="select" id="fieldAddToPCL"></select></div></div>
                <div class="form-section"><div class="form-section-title">Tracking Info (Read Only)</div>
                  <div class="form-row"><div class="form-group"><label class="label">Date Last Touch</label><input type="text" class="input input-readonly" id="fieldDateLastTouch" readonly></div><div class="form-group"><label class="label">Created Date</label><input type="text" class="input input-readonly" id="fieldCreatedDate" readonly></div></div>
                  <div class="form-row"><div class="form-group"><label class="label">Created By</label><input type="text" class="input input-readonly" id="fieldCreatedBy" readonly></div><div class="form-group"><label class="label">Last Modified By</label><input type="text" class="input input-readonly" id="fieldLastModifiedBy" readonly></div></div>
                  <div class="form-row"><div class="form-group"><label class="label">Priority Score</label><input type="text" class="input input-readonly" id="fieldPriorityScore" readonly></div><div class="form-group"><label class="label">Contract ID</label><input type="text" class="input input-readonly" id="fieldContractId" readonly></div></div>
                </div>
              </div>
              <div class="tab-panel" id="tabNotes">
                <div class="form-group"><label class="label">Additional Notes</label><textarea class="textarea" id="fieldAdditionalNotes" rows="5" placeholder="General notes about this lead..."></textarea></div>
                <div class="form-group"><label class="label">Follow Up Notes</label><textarea class="textarea" id="fieldFollowupNotes" rows="5" placeholder="Notes about follow-up activities..."></textarea></div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <div class="modal-actions-left">
              <button type="button" class="btn btn-ghost" onclick="callLead()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:16px;height:16px;"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg> Call</button>
              <button type="button" class="btn btn-ghost" onclick="emailLead()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:16px;height:16px;"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M22 6l-10 7L2 6"/></svg> Email</button>
              <button type="button" class="btn btn-ghost" onclick="generateContract()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:16px;height:16px;"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg> Contract</button>
            </div>
            <div class="modal-actions-right">
              <button type="button" class="btn" onclick="closeModal('leadModal')">Cancel</button>
              <button type="button" class="btn btn-primary" onclick="saveLead()">Save</button>
            </div>
          </div>
        </div>
      </div>

      <!-- CALL MODE MODAL -->
      <div class="modal-backdrop" id="callModal" onclick="closeModalOnBackdrop(event, 'callModal')">
        <div class="modal modal-call">
          <div class="call-header">
            <div class="call-contact">
              <div class="avatar avatar-lg" id="callAvatar">JD</div>
              <div class="call-info"><h2 class="call-name" id="callName">John Doe</h2><p class="call-event" id="callEvent">Corporate Holiday Party</p></div>
            </div>
            <button class="btn-icon" onclick="closeModal('callModal')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
          </div>
          <div class="call-body">
            <div class="call-details">
              <div class="call-detail"><span class="call-detail-label">Phone</span><a class="call-detail-value call-phone" id="callPhone" href="tel:">-</a></div>
              <div class="call-detail"><span class="call-detail-label">Quote</span><span class="call-detail-value" id="callQuote">-</span></div>
              <div class="call-detail"><span class="call-detail-label">Event Date</span><span class="call-detail-value" id="callEventDate">-</span></div>
              <div class="call-detail"><span class="call-detail-label">Last Notes</span><span class="call-detail-value call-notes" id="callNotes">-</span></div>
            </div>
            <div class="call-result">
              <label class="label">Call Result</label>
              <div class="call-result-options">
                <button type="button" class="result-btn" data-result="No Answer" onclick="selectCallResult(this)">No Answer</button>
                <button type="button" class="result-btn" data-result="Left VM" onclick="selectCallResult(this)">Left VM</button>
                <button type="button" class="result-btn" data-result="Talked" onclick="selectCallResult(this)">Talked</button>
                <button type="button" class="result-btn" data-result="Wrong Number" onclick="selectCallResult(this)">Wrong #</button>
                <button type="button" class="result-btn" data-result="Callback" onclick="selectCallResult(this)">Callback</button>
              </div>
            </div>
            <div class="call-status-update" id="callStatusUpdate" style="display: none;">
              <label class="label">Update Status</label>
              <div class="status-options">
                <button type="button" class="status-btn status-hot" data-status="Hot" onclick="selectStatus(this)">Hot</button>
                <button type="button" class="status-btn status-warm" data-status="Warm" onclick="selectStatus(this)">Warm</button>
                <button type="button" class="status-btn status-cold" data-status="Cold" onclick="selectStatus(this)">Cold</button>
                <button type="button" class="status-btn status-dead" data-status="Dead" onclick="selectStatus(this)">Dead</button>
              </div>
            </div>
            <div class="form-group"><label class="label">Quick Note</label><textarea class="textarea" id="callQuickNote" rows="2" placeholder="Add notes from this call..."></textarea></div>
          </div>
          <div class="call-footer">
            <button class="btn btn-primary btn-lg btn-full" onclick="saveCallAndNext()">Save & Next Lead <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
          </div>
        </div>
      </div>

      <!-- Toast Container -->
      <div class="toasts" id="toastContainer"></div>
    </main>
  </div>

  <?!= include('Scripts.html'); ?>
</body>
</html>
